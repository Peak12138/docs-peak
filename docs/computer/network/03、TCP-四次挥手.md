# 三、TCP-四次挥手

![image.png](https://peak-1316803036.cos.ap-beijing.myqcloud.com/916675e9166d4c62accd59624ce5f8c7~tplv-k3u1fbpfcp-zoom-in-crop-mark%3A1512%3A0%3A0%3A0.awebp)

1.断开连接服务端和客户端都可以主动发起我们拿客户端举例，客户端进行断开操作先发送`FIN`包生成客户端的`seq`序列号随后进入`wait1状态` ,这是第一次挥手。

2.服务端收到FIN包表示自己进入了关闭等待状态，然后向客户端使用ack验证，验证成功打上ACK标记，随后生成服务端的`seq值`发送给客户端，这是第二次挥手，服务端此时还可以发送未完成的数据。

3.等待服务端所有任务操作完成之后服务端开始进入最后确认状态，向客户端发送`FIN包`,并且验证ack，使用客户端第一次的`seq + 1`去验证，验证成功打上ACK标记，并且生成一个新的序列号seq发送给客户端，这是第三次挥手。

4.客户端收到之后进入超时等待状态`2MSL（1-4分钟）`，经过等到后客户端关闭连接，而服务端收到信息验证完成ack成功之后打上`ACk`标记随后将关闭连接。

**为什么需要超时等待时间?**

```
这是为了保证服务端收到ACK包，假设如果没有2MSL的等待时间，ACK包丢失了，那服务端将永远不会断开连接，有了2MSL，如果一旦发生丢包将会进行超时重传，实现可靠连接。
```